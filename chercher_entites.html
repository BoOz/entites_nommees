#CACHE{0}
[(#SET{regdate,^#ENV{sdate,19|20}})]
[(#SET{affdate,[(#ENV{sdate}|nom_mois)] [(#ENV{sdate}|annee)]})]
[(#SET{fin,[(#ENV{sdate}|match{^\d\d\d\d$}|?{[(#ENV{sdate})]-12,[(#ENV{sdate,[(#ENV{date}|annee)]-[(#ENV{date}|mois)]})]})]})]

#SET{entites,#ARRAY}

<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	#INSERT_HEAD
	<style>
		h1 {
			margin:0;
		}
		h2{
			margin:0 20%;
		}
		ul {
			margin:0;
			list-style-type:none;
			padding:0;
		}
		.col{
			float:left;
			width:12%;
			margin-left:30px;
		}
	</style>
</head>
<body>

<div style="float:right;width:15%">
<INCLURE{fond=noms_navigation,mode_chercher=chercher_entites}>
</div>

<h1>Entités nommées <small style="font-size:0.5em">dans #NOM_SITE_SPIP</small></h1>

<B_art>
	<span>#TOTAL_BOUCLE articles. [(#GET{regdate})]</span>
	<h2>[(#GET{affdate}|trim|sinon{#ENV{sdate}})]</h2>

	<BOUCLE_art(ARTICLES){id_article ?}{statut IN prop, publie}{!par date_redac}{id_secteur=1}{date_redac==#GET{regdate}}{0,#ENV{nb_articles,100}}>
	#SET{texte,#CHAPO*|concat{#TEXTE*}|preparer_texte}
	#SET{entites,#GET{entites}|array_merge{#GET{texte}|trouver_entites{#ID_ARTICLE}}}
	</BOUCLE_art>

	<div id="debug" style="float:left;width:80%; max-height:500px;margin: 0 30px;overflow:auto">
	
	#SET{entites_groupees,#GET{entites}|grouper_entites}

	<B_residus_frequents>
	#ANCRE_PAGINATION
	<h3>Entités résiduelles (#GRAND_TOTAL)</h3>
	<BOUCLE_residus_frequents(DATA){source table, #GET{entites_groupees}|table_valeur{INDETERMINE} }{!par valeur}{valeur > 1}{pagination 500}>
		<span>#CLE&nbsp;<small><a href="?page=entites_nommees[&amp;entite=(#CLE|rawurlencode)][&amp;sdate=(#ENV{sdate})][&amp;nb_articles=(#ENV{nb_articles})]">[(#VALEUR)]&nbsp;fois</a></small></span>
	</BOUCLE_residus_frequents>
	<p>#PAGINATION</p>
	</B_residus_frequents>


#SET{filtre_entites,INDETERMINE}

[(#ENV{entite}|oui) #SET{filtre_entites,^#ENV{entite}} ]


	<B_fragments>
	<h3>[(#ENV{entite}|sinon{Article #ENV{id_article}})] (#GRAND_TOTAL entités résiduelles)</h3>
	#ANCRE_PAGINATION
	<BOUCLE_fragments(DATA){source table, #GET{entites} }{valeur == #GET{filtre_entites} }{!par cle}{pagination 100}>
		#SET{valeur,#VALEUR|explode{|}}
		<div><strong>[(#GET{valeur}|table_valeur{0})] :</strong> [(#GET{valeur}|table_valeur{3})] 
		<small><a href="?page=entites_nommees&amp;id_article=[(#GET{valeur}|table_valeur{2})]">[voir]</a></small>
		</div>
	</BOUCLE_fragments>
	<p>#PAGINATION</p>
	</B_fragments>	


	<BOUCLE_texte_article(ARTICLES){id_article}{statut IN prop, publie}>	

	<h3>#TITRE<small> — <a href="?page=entites_nommees&amp;sdate=[(#DATE_REDAC|annee)][-(#DATE_REDAC|mois)]">[(#DATE_REDAC|annee)][-(#DATE_REDAC|mois)]</a></small></h3>	
		
	<div class="texte">
		[(#CHAPO|concat{
			#TEXTE})]
		<div>
		#NOTES
		</div>
	</div>
	</BOUCLE_texte_article>

</div>


<div class="col" style="clear:left">
 <h3>Personnalités</h3>

<B_noms_frequents>
#ANCRE_PAGINATION
<ul>
<BOUCLE_noms_frequents(DATA){source table, #GET{entites_groupees}|table_valeur{Personnalités}|entites_nommees|table_valeur{personnalites}}{!par valeur}{valeur > 1}{pagination 1000}>
	<li>#CLE&nbsp;<small><a href="?page=entites_nommees[&amp;entite=(#CLE|rawurlencode)][&amp;sdate=(#ENV{sdate})][&amp;nb_articles=(#ENV{nb_articles})][&amp;id_article=(#ENV{id_article})]">[(#VALEUR)]&nbsp;fois</a>
</small>
	</li>
</BOUCLE_noms_frequents>
</ul>
<p>#PAGINATION</p>
</B_noms_frequents>


<B_noms>
#ANCRE_PAGINATION
<ul>
<BOUCLE_noms(DATA){source table, #GET{entites_groupees}|table_valeur{Personnalités}|entites_nommees|table_valeur{personnalites}}{par cle}{valeur = 1}{pagination 1000}>
	<li>#CLE&nbsp;<small><a href="?page=entites_nommees[&amp;entite=(#CLE|rawurlencode)][&amp;sdate=(#ENV{sdate})][&amp;nb_articles=(#ENV{nb_articles})][&amp;id_article=(#ENV{id_article})]">[(#VALEUR)]&nbsp;fois</a>
</small></li>
</BOUCLE_noms>
</ul>
<p>#PAGINATION</p>
</B_noms>
</div>


#SET{fragments,#GET{fragments}|agreger_fragments}

<div class="col">

 <h3>Partis politiques</h3>

<B_Partis>
#ANCRE_PAGINATION
<ul>
<BOUCLE_Partis(DATA){source table, #GET{entites_groupees}|table_valeur{Partis politiques} }{!par valeur}{pagination 1000}>
	<li>#CLE&nbsp;<small>#VALEUR fois</small></li>
</BOUCLE_Partis>
</ul>
<p>#PAGINATION</p>
</B_Partis>



 <h3>Institutions</h3>

<B_entites>
#ANCRE_PAGINATION
<ul>
<BOUCLE_entites(DATA){source table, #GET{entites_groupees}|table_valeur{Institutions} }{!par valeur}{pagination 1000}>
	<li>#CLE&nbsp;<small>#VALEUR fois</small></li>
</BOUCLE_entites>
</ul>
<p>#PAGINATION</p>
</B_entites>

 <h3>Institutions (auto)</h3>

<B_institutions_frequents>
#ANCRE_PAGINATION
<ul>
<BOUCLE_institutions_frequents(DATA){source table, #GET{entites_groupees}|table_valeur{Personnalités}|entites_nommees|table_valeur{institutions}}{!par valeur}{valeur > 1}{pagination 1000}>
	<li>#CLE&nbsp;<small>#VALEUR fois</small></li>
</BOUCLE_institutions_frequents>
</ul>
<p>#PAGINATION</p>
</B_institutions_frequents>


<B_institutions>
#ANCRE_PAGINATION
<ul>
<BOUCLE_institutions(DATA){source table, #GET{entites_groupees}|table_valeur{Personnalités}|entites_nommees|table_valeur{institutions}}{par cle}{valeur = 1}{pagination 1000}>
	<li>#CLE&nbsp;<small>#VALEUR fois</small></li>
</BOUCLE_institutions>
</ul>
<p>#PAGINATION</p>
</B_institutions>

</div>

<div class="col">

<h3>Pays</h3>
<B_pays_frequents>
#ANCRE_PAGINATION
<ul>
<BOUCLE_pays_frequents(DATA){source table, #GET{entites_groupees}|table_valeur{Pays} }{!par valeur}{valeur > 1}{pagination 20}>
	<li>#CLE&nbsp;<small>#VALEUR fois</small></li>
</BOUCLE_pays_frequents>
</ul>
<p>#PAGINATION</p>
</B_pays_frequents>

<B_pays>
#ANCRE_PAGINATION
<ul>
<BOUCLE_pays(DATA){source table, #GET{entites_groupees}|table_valeur{Pays} }{par cle}{valeur = 1}{pagination 500}>
	<li>#CLE&nbsp;<small>#VALEUR fois</small></li>
</BOUCLE_pays>
</ul>
<p>#PAGINATION</p>
</B_pays>

<h3>Géographie</h3>
<B_geo_frequents>
#ANCRE_PAGINATION
<ul>
<BOUCLE_geo_frequents(DATA){source table, #GET{entites_groupees}|table_valeur{Geographie} }{!par valeur}{valeur > 1}{pagination 20}>
	<li>#CLE&nbsp;<small>#VALEUR fois</small></li>
</BOUCLE_geo_frequents>
</ul>
<p>#PAGINATION</p>
</B_geo_frequents>

<B_geo>
#ANCRE_PAGINATION
<ul>
<BOUCLE_geo(DATA){source table, #GET{entites_groupees}|table_valeur{Geographie} }{par cle}{valeur = 1}{pagination 500}>
	<li>#CLE&nbsp;<small>#VALEUR fois</small></li>
</BOUCLE_geo>
</ul>
<p>#PAGINATION</p>
</B_geo>

<h3>Lieux (auto)</h3>

<B_lieux_frequents>
#ANCRE_PAGINATION
<ul>
<BOUCLE_lieux_frequents(DATA){source table, #GET{entites_groupees}|table_valeur{Personnalités}|afficher_noms|entites_nommees|table_valeur{lieux}}{!par valeur}{valeur > 1}{pagination 1000}>
	<li>#CLE&nbsp;<small>#VALEUR fois</small></li>
</BOUCLE_lieux_frequents>
</ul>
<p>#PAGINATION</p>
</B_lieux_frequents>


<B_lieux_auto>
#ANCRE_PAGINATION
<ul>
<BOUCLE_lieux_auto(DATA){source table, #GET{entites_groupees}|table_valeur{Personnalités}|entites_nommees|table_valeur{lieux}}{par cle}{valeur = 1}{pagination 1000}>
	<li>#CLE&nbsp;<small>#VALEUR fois</small></li>
</BOUCLE_lieux_auto>
</ul>
<p>#PAGINATION</p>
</B_lieux_auto>



</div>

<div class="col">

<h4>Villes</h4>
<B_villes>
#ANCRE_PAGINATION
<ul>
<BOUCLE_villes(DATA){source table, #GET{entites_groupees}|table_valeur{Villes} }{!par valeur}{pagination 500}>
	<li>#CLE&nbsp;<small>#VALEUR fois</small></li>
</BOUCLE_villes>
</ul>
<p>#PAGINATION</p>
</B_villes>

</div>

<div class="col">
 <h3>Journaux</h3>

	<B_journaux>
	#ANCRE_PAGINATION
	<ul>
	<BOUCLE_journaux(DATA){source table, #GET{entites_groupees}|table_valeur{Journaux} }{par cle}{valeur = 1}{pagination 1000}>
		<li>#CLE&nbsp;<small>#VALEUR fois</small></li>
	</BOUCLE_journaux>
	</ul>
	<p>#PAGINATION</p>
	</B_journaux>

 <h3>Sources</h3>

<B_sources_frequents>
#ANCRE_PAGINATION
<ul>
<BOUCLE_sources_frequents(DATA){source table, #GET{entites_groupees}|table_valeur{Sources} }{!par valeur}{valeur > 1}{pagination 1000}>
	<li>#CLE&nbsp;<small>#VALEUR fois</small></li>
</BOUCLE_sources_frequents>
</ul>
<p>#PAGINATION</p>
</B_sources_frequents>


<B_sources>
#ANCRE_PAGINATION
<ul>
<BOUCLE_sources(DATA){source table, #GET{entites_groupees}|table_valeur{Sources} }{par cle}{valeur = 1}{pagination 1000}>
	<li>#CLE&nbsp;<small>#VALEUR fois</small></li>
</BOUCLE_sources>
</ul>
<p>#PAGINATION</p>
</B_sources>


</div>

<div class="col">

<h3>Peuples</h3>

<B_peuples>
#ANCRE_PAGINATION
<ul>
<BOUCLE_peuples(DATA){source table, #GET{entites_groupees}|table_valeur{Peuples} }{!par valeur}{pagination 1000}>
	<li>#CLE&nbsp;<small>#VALEUR fois</small></li>
</BOUCLE_peuples>
</ul>
<p>#PAGINATION</p>
</B_peuples>

</div>

<hr style="clear:both" />
</body>
</html>