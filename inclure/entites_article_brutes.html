<BOUCLE_article(ARTICLES){id_article}{statut IN prepa, prop, publie}>	
#SET{comp,''}

[(#REM) Calcul direct des entités d'un article sans enregistrement // plutot en mode debug ]
[(#REM) Prévoir un autre bloc avec les entites validées en bdd ? ]


#SET{texte,#TITRE*|concat{" // "}|concat{#CHAPO*}|concat{" // "}|concat{#TEXTE*}|preparer_texte}
#SET{entites,#GET{texte}|trouver_entites{#ID_ARTICLE}|entites_to_array}

[(#REM) trier les entites connues ]

#SET{poids,#ARRAY}
<BOUCLE_poids_entites(DATA){source table,#GET{entites}}{fusion entite}>#SET{total,0}
<BOUCLE_n(DATA){source table,#GET{entites}}{entite=#ENTITE} />#SET{total,#TOTAL_BOUCLE}<//B_n>
#SET{poids,#GET{poids}|array_merge{#ARRAY{#ENTITE,#GET{total}}}}
</BOUCLE_poids_entites>

#SET{max,#GET{poids}|max}
#SET{moyenne,#GET{poids}|array_sum|div{#GET{poids}|count}}

<h2 id="references" style="margin-top:60px">Entités nommées</h2>
<p>Ces références sont détectées automatiquement dans le texte par un algorithme. Il peut y avoir des erreurs.</p>

<B_personnalites>
<h3 style="margin-top:1.5em">Personnalités</h3>
<BOUCLE_personnalites(DATA){source table,#GET{entites}}{type_entite IN Personnalités}{fusion entite}{par entite}{", "}><a href="[(#URL_PAGE{entite,id_entite=#ENTITE})]">[<span title="[(#GET{poids}|table_valeur{#ENTITE})]">(#ENTITE)</span>]</a></BOUCLE_personnalites>

<B_institutions>
<h3 style="margin-top:1.5em">Institutions</h3>
<BOUCLE_institutions(DATA){source table,#GET{entites}}{type_entite IN Institutions,Partis politiques}{fusion entite}{par entite}{", "}>
	[<span title="[(#GET{poids}|table_valeur{#ENTITE})]"><a href="[(#URL_PAGE{entite,id_entite=#ENTITE})]">(#ENTITE)</a></span>]
</BOUCLE_institutions>

<BOUCLE_types_entites_nommees(DATA){source table,#GET{entites}}{type_entite !IN INDETERMINE,Personnalités,Institutions,Partis politiques}{fusion type_entite}>
<h3 style="margin-top:1.5em">#TYPE_ENTITE</h3>
<BOUCLE_entites(DATA){source table,#GET{entites}}{type_entite=#TYPE_ENTITE}{fusion entite}{par entite}{", "}>
	[<span title="[(#GET{poids}|table_valeur{#ENTITE})]"><a href="[(#URL_PAGE{entite,id_entite=#ENTITE})]">(#ENTITE)</a></span>]
</BOUCLE_entites>
</BOUCLE_types_entites_nommees>

<B_entites_inconnues>
<h3 style="margin-top:1.5em">Entités inconnues</h3>
<BOUCLE_entites_inconnues(DATA){source table,#GET{entites}}{type_entite = INDETERMINE}>
<p><strong><a href="[(#URL_PAGE{entite,id_entite=#ENTITE})]">#ENTITE</a></strong> : [(#EXTRAIT)]</p>
</BOUCLE_entites_inconnues>

</BOUCLE_article>

