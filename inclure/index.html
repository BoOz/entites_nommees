	<style>
		ul {
			margin:0;
			list-style-type:none;
			padding:0;
		}
		.col{
			width:150px;
			margin-right:32px;
			margin-bottom:60px;
		}
		.col ul {
			max-height:500px;
			overflow:auto;
		}
		.amis{
			margin:30px 0 ;
		}
		.a_ajouter {
		    background-color: #2c3f4f;
		    color: #bbbbbb;
		    margin: 0;
		    padding: 40px ;
		}
		.a_ajouter a{
			color : white ;
		}
		.entites_residuelles {
		    margin: 0;
		    padding: 40px ;
		}
		.entites_residuelles a{
		}
	</style>


		<B_fragments_entite>
		<div style="max-height:200px;overflow:auto;clear:left; margin: 40px 60px 20px 0px;padding: 0 50px;width:66%">
		#ANCRE_PAGINATION
		<BOUCLE_fragments_entite(DATA){source sql, #VAL{"select entite, extrait, id_article, type_entite from entites_nommees where entite=LENTITE order by date desc"}|replace{LENTITE,#ENV{entite}|_q} }{!par valeur}{valeur > 1}{pagination 500}{si #ENV{entite}|oui}>
			<p>
				<BOUCLE_article(ARTICLES){id_article=#ID_ARTICLE}{statut IN prop, publie}>
				<strong>[(#DATE_REDAC|nom_mois)][ (#DATE_REDAC|annee)]</strong></BOUCLE_article> : [(#EXTRAIT)] 
				<small><a href="?page=entites_nommees&amp;id_article=[(#ID_ARTICLE)]" title="Extrait de « [(#TITRE)] »">[voir]</a></small>
			</p>
		</BOUCLE_fragments_entite>
			<p>#PAGINATION</p>
		</div>
		</B_fragments_entite>
	
	
		#SET{comp,'having nb > 5'}
		<BOUCLE_texte_article(ARTICLES){id_article}{statut IN prepa, prop, publie}>	
		#SET{comp,''}
		<h3 style="clear:left;">#TITRE</h3>
	
		[(#REM) Débug : Entites d'un article en direct sans enregistrement ]
	
		#SET{texte,#TITRE*|concat{" // "}|concat{#CHAPO*}|concat{" // "}|concat{#TEXTE*}|preparer_texte}
		#SET{entites,#ARRAY}
		#SET{entites,#GET{entites}|array_merge{#GET{texte}|trouver_entites{#ID_ARTICLE}}}
	
		<div style="max-height:200px;overflow:auto;clear:left; margin: 40px 60px 20px 0px;padding: 0 50px;width:66%;display: flex; flex-flow: row wrap;">
			<BOUCLE_entites_articles(DATA){source table,#GET{entites}}>
			[<p>
				 <strong>(#VALEUR|explode{"|"}|table_valeur{0})</strong> ([(#VALEUR|explode{"|"}|table_valeur{1})]) : [(#VALEUR|explode{"|"}|table_valeur{3})]
				
			</p>]
			</BOUCLE_entites_articles>
			<h4>Texte</h4>	
			<div class="texte">
				[(#CHAPO|concat{
					#TEXTE})]
				<div>
				#NOTES
				</div>
			</div>
		</div>
		</BOUCLE_texte_article>
	
	<div style="margin:0 40px 0 0;display: flex; flex-flow: row wrap;">
		
		<B_personnalites_frequents>
			#ANCRE_PAGINATION
		<div class="col">
			<h3>Personnalités</h3>
			<ul>
			<BOUCLE_personnalites_frequents(DATA){source sql, #VAL{"select entite , count(id_entite) nb from entites_nommees where type_entite='Personnalités' ANDWHERE group by entite COMP order by nb desc"}|replace{ANDWHERE,#GET{andwhere}}|replace{COMP,#GET{comp}}}{pagination 1000}>
				<li>#ENTITE&nbsp;<small><a href="?page=entite[&amp;entite=(#ENTITE|rawurlencode)][&amp;sdate=(#ENV{sdate})][&amp;nb_articles=(#ENV{nb_articles})][&amp;id_article=(#ENV{id_article})]">[(#NB)]&nbsp;fois</a>
			</small>
				</li>
			</BOUCLE_personnalites_frequents>
			</ul>
			<p>#PAGINATION</p>
			</B_personnalites_frequents>
		</div>
		
		#SET{notin,#ARRAY}
		
		[(#REM).Rassembler les institutions ]
		
		<B_institutions_frequents> 
		<div class="col">
			<h3>Institutions</h3>
				#ANCRE_PAGINATION
				<ul>
				<BOUCLE_institutions_frequents(DATA){source sql, #VAL{"select type_entite, entite , count(id_entite) nb from entites_nommees where type_entite in ('Institutions', 'Institutions automatiques') ANDWHERE group by entite order by nb desc"}|replace{TYPEENTITE,#TYPE_ENTITE}|replace{ANDWHERE,#GET{andwhere}} }{pagination 1000}>
					<li>#ENTITE&nbsp;<small><a href="?page=entite[&amp;entite=(#ENTITE|rawurlencode)][&amp;sdate=(#ENV{sdate})][&amp;nb_articles=(#ENV{nb_articles})][&amp;id_article=(#ENV{id_article})]">[(#NB)]&nbsp;fois</a>[(#TYPE_ENTITE|match{auto}|oui) (auto) ]
				</small>
					</li>
				</BOUCLE_institutions_frequents>
				</ul>
				<p>#PAGINATION</p>
			</div>
		</B_institutions_frequents>
		
		<B_lieux_frequents> 
		<div class="col">
			<h3>Lieux</h3>
				#ANCRE_PAGINATION
				<ul>
				<BOUCLE_lieux_frequents(DATA){source sql, #VAL{"select type_entite, entite , count(id_entite) nb from entites_nommees where type_entite in ('Pays', 'Geographie', 'Geographie', 'Géographie (auto)', 'Villes') ANDWHERE group by entite order by nb desc"}|replace{TYPEENTITE,#TYPE_ENTITE}|replace{ANDWHERE,#GET{andwhere}} }{pagination 1000}>
					#SET{notin,#GET{notin}|push{#TYPE_ENTITE|_q}}
					<li>#ENTITE&nbsp;<small><a href="?page=entite[&amp;entite=(#ENTITE|rawurlencode)][&amp;sdate=(#ENV{sdate})][&amp;nb_articles=(#ENV{nb_articles})][&amp;id_article=(#ENV{id_article})]">[(#NB)]&nbsp;fois</a>[(#TYPE_ENTITE|match{auto}|oui) (auto) ]
				</small>
					</li>
				</BOUCLE_lieux_frequents>
				</ul>
				<p>#PAGINATION</p>
			</div>
		</B_lieux_frequents>
		
		[(#REM) afficher les entites suivantes en premier ]
		<BOUCLE_types(DATA){source sql, #VAL{"select type_entite from entites_nommees where type_entite in ('Partis politiques', 'Sujets') ANDWHERE group by type_entite order by type_entite desc"}|replace{ANDWHERE,#GET{andwhere}}}>
			#SET{notin,#GET{notin}|push{#TYPE_ENTITE|_q}}
			<div class="col" [ style="(#COMPTEUR_BOUCLE|alterner{'','','','',''})"]>
			<B_entite_frequents> 
			<h3>[(#TYPE_ENTITE|replace{_," "})]</h3>
				#ANCRE_PAGINATION
				<ul>
				<BOUCLE_entite_frequents(DATA){source sql, #VAL{"select entite , count(id_entite) nb from entites_nommees where type_entite='TYPEENTITE' ANDWHERE group by entite order by nb desc"}|replace{TYPEENTITE,#TYPE_ENTITE}|replace{ANDWHERE,#GET{andwhere}} }{pagination 1000}>
					<li>#ENTITE&nbsp;<small><a href="?page=entite[&amp;entite=(#ENTITE|rawurlencode)][&amp;sdate=(#ENV{sdate})][&amp;nb_articles=(#ENV{nb_articles})][&amp;id_article=(#ENV{id_article})]">[(#NB)]&nbsp;fois</a>
				</small>
					</li>
				</BOUCLE_entite_frequents>
				</ul>
				<p>#PAGINATION</p>
			</B_entite_frequents>
			</div>
		</BOUCLE_types>
		[(#SET{notin,#VAL{"and type_entite not in("}|concat{#GET{notin}|join{","}}|concat{")"}})]
		
		
		<BOUCLE_types_autres(DATA){source sql, #VAL{"select type_entite from entites_nommees where type_entite not in ('INDETERMINE', 'PASDENTITE', 'Personnalités','a ajouter', 'Institutions', 'Institutions automatiques') ANDWHERE NOTIN group by type_entite"}|replace{ANDWHERE,#GET{andwhere}}|replace{NOTIN,#GET{notin}}}>
			<div class="col" [ style="(#COMPTEUR_BOUCLE|alterner{'clear:both','','','','',''})"]>
			<B_entite_frequents_autres> 
			<h3>[(#TYPE_ENTITE|replace{_," "})]</h3>
				#ANCRE_PAGINATION
				<ul>
				<BOUCLE_entite_frequents_autres(DATA){source sql, #VAL{"select entite , count(id_entite) nb from entites_nommees where type_entite='TYPEENTITE' ANDWHERE group by entite order by nb desc"}|replace{TYPEENTITE,#TYPE_ENTITE}|replace{ANDWHERE,#GET{andwhere}} }{pagination 1000}>
					<li>#ENTITE&nbsp;<small><a href="?page=entite[&amp;entite=(#ENTITE|rawurlencode)][&amp;sdate=(#ENV{sdate})][&amp;nb_articles=(#ENV{nb_articles})][&amp;id_article=(#ENV{id_article})]">[(#NB)]&nbsp;fois</a>
				</small>
					</li>
				</BOUCLE_entite_frequents_autres>
				</ul>
				<p>#PAGINATION</p>
			</B_entite_frequents_autres>
			</div>
		</BOUCLE_types_autres>
	
</div>
<div class="a_ajouter" style="clear:both;line-height:1.3em">
	<B_a_ajouter>
		#ANCRE_PAGINATION
	
	 <h3>À ajouter</h3>
	
		<ul>
		<BOUCLE_a_ajouter(DATA){source sql, #VAL{"select entite , count(id_entite) nb from entites_nommees where type_entite='a ajouter' ANDWHERE group by entite order by nb desc"}|replace{ANDWHERE,#GET{andwhere}}|replace{COMP,#GET{comp}}}{pagination 1000}>
			<li style="float:left;padding-right:15px">
			#ENTITE&nbsp;<small><a href="?page=entite[&amp;entite=(#ENTITE|rawurlencode)][&amp;sdate=(#ENV{sdate})][&amp;nb_articles=(#ENV{nb_articles})][&amp;id_article=(#ENV{id_article})]">[(#NB)]&nbsp;fois</a>
		</small>
			</li>
		</BOUCLE_a_ajouter>
		</ul>
		<p>#PAGINATION</p>
	</B_a_ajouter>

<br style="clear:both" />

</div>
